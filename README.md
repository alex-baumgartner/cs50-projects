# Expense Tracking Application (Final project)
#### Video Demo:  <https://youtu.be/15sI52392go>

## Description:

### Static folder

#### chart.jpg
This file is generated by the python library "matplotlib" upon creating a chart that is displayed in the budget vs. monthly expenses tab.

### templates folder

#### apology.html
Based on the apology used in pset 9 (finance) this html file handles expected exceptions by providing an error message+code to display for the users.

#### budget.html
This html file is used to set a new budget for the user, which is then displayed for comparison in the inded tab (overview) as well as the budget vs. monthly expenses tab.

#### chart.html
This html file is used to display the chart that was generated by the python library "matplotlib".

#### expense-add.html
This html file is used to add a new expense where the category, amount, date and description can be set by the user before submitting.

#### expense-edit.html
This html file is used to edit the category, amount, date and description of an existing expense after it was created.

#### filter-expenses.html
This html file is used to filter for expenses in a specific category /or timerange that can be selected by the user.

#### filtered-expenses.html
This html displays the expenses after applying the filters set in the filter-expenses.html file after submitting. The user has the possibility to edit or (upon confirmation) delete individual expenses.

#### index.html
This html file displays all expenses entered by the user with a total monthly expense, which is compared to the user's monthly budget at the bottom of each month. It also gives the user the possibility to edit or (upon confirmation) delete individual expenses.

#### layout.html
Also heavily inspired from pset9, this is the template html which is extended in the rest of the html files and includes a header that based on the login status shows different tabs that allow the user to access different routes.

#### login.html
This html file handles the login process for the expense tracking application.

#### register.html
This html file handles the registration process of a new user of the expense tracking application.

#### statistics.html
This html file shows some interesting statistics gathered from the user's data. It shows the top 3 categories where the users spends the most money on as well as a top 3 list of months where the most money was spent.

#### app.py

The `app.py` file is the main part of the expense tracking application. It contains the routes, database configurations, and various functions used to handle requests and render templates. Here's a breakdown of the different sections and functionalities in the file:

##### Import Statements

The import statements at the beginning of the file bring in the necessary modules and libraries required for the application, including Flask, SQL, matplotlib, numpy, and helper functions.

##### Flask Application Setup

The Flask application is created and configured using the `Flask` class from the `flask` module. The `Session` class from the `flask_session` module is used to configure session handling. An instance of the SQL class is created to interact with the SQLite database.

##### Custom Filters and Global Variables

A custom filter called "usd" is registered with Jinja2, allowing you to format currency values in templates. The `months_dict` dictionary is defined, which maps month numbers to their corresponding three-letter abbreviations.

##### Route Definitions

The file defines several routes that handle different HTTP requests:

- `/`: The index route, accessible only to logged-in users. It retrieves expenses, groups them by month, sorts them, and renders the `index.html` template with the required data.

- `/budget`: This route allows users to set their budget. If a POST request is made, it validates and updates the budget in the database. If a GET request is made, it renders the `budget.html` template.

- `/chart`: This route generates a chart of monthly expenses vs. budget. It retrieves budget information, monthly expense data, and generates the chart using matplotlib. The chart is saved as an image file, and the `chart.html` template is rendered with the chart file path.

- `/expense-add`: Handles adding new expenses. If a POST request is made, it validates the submitted form data and inserts the expense into the database. If a GET request is made, it retrieves the current date and category data and renders the `expense-add.html` template.

- `/expense-delete/<int:expense_id>`: Deletes a specific expense based on the provided `expense_id` parameter. It checks if the expense exists and belongs to the current user before deleting it.

- `/expense-edit/<int:expense_id>`: Allows editing an existing expense. If a POST request is made, it validates the submitted form data and updates the expense in the database. If a GET request is made, it retrieves the expense and category data and renders the `expense-edit.html` template.

- `/filter-expenses`: Handles filtering expenses based on various criteria. If a POST request is made, it retrieves the filter options, constructs a query, and retrieves the filtered expenses. If a GET request is made, it retrieves the category data and renders the `filter-expenses.html` template.

- `/login`: Handles user login. If a POST request is made, it validates the submitted credentials and logs the user in by storing their `user_id` in the session. If a GET request is made, it renders the `login.html` template.

- `/logout`: Logs the user out by clearing the session and redirects them to the login form.

- `/register`: Handles user registration. If a POST request is made, it validates the submitted form data, checks for existing users, and inserts the new user into the database. If a GET request is made, it renders the `register.html` template.

- `/statistics`: Displays statistics about the user's spending habits. It retrieves the top categories and top months based on the total expense amount and renders the `statistics.html` template with the data.

##### Helper Functions

Several helper functions are defined in the file:

- `get_categories`: Retrieves the expense categories from the database.

- `get_year_of_monthly_expenses`: Retrieves monthly expense data for the past 12 months based on the current user. It aggregates the expenses by month and returns the data as a dictionary.

- `create_trendline`: Calculates the trendline (linear regression line) for the expense data using NumPy's `polyfit` and `polyval` functions.

### database

The used database is a sqlite3 database with the following table definitions:

#### users
```
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT NOT NULL,
    password TEXT NOT NULL
);
```
This table stores the user information like username and password after it has been encrypted.

#### categories
```
CREATE TABLE categories (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL
);
```
This table stores the different categories that can be chosen by the users for their expenses.

#### expenses
```
CREATE TABLE expenses (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    date DATE NOT NULL,
    category_id INTEGER NOT NULL,
    amount REAL NOT NULL,
    description TEXT,
    FOREIGN KEY (user_id) REFERENCES users (id),
    FOREIGN KEY (category_id) REFERENCES categories (id)
);
```
This table stores the expenses for each user referencing the users and the categories table.

#### budgets
```
CREATE TABLE budgets (id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, amount REAL NOT NULL, FOREIGN KEY (user_id) REFERENCES users (id));
```
This table stores the budget for each user referencing the users table.


#### helpers.py

The `helpers.py` file contains various helper functions that are used in the main `app.py` file. These functions provide additional functionality and utility for handling requests, data manipulation, and rendering templates. Let's go through the different functions in detail:

##### `login_required` Decorator

This decorator function is used to enforce login requirement for certain routes. It checks if a user is logged in by verifying if their `user_id` is present in the session. If the user is not logged in, it redirects them to the login page. This decorator is used to protect routes that should only be accessible to authenticated users.

##### `apology` Function

This function is used to render an apology message as a response to the user. It takes a `message` parameter, which represents the apology message to be displayed, and an optional `code` parameter, which specifies the HTTP status code for the response. The function replaces special characters in the message to ensure proper rendering.

##### `usd` Function

This function is a filter that formats a numeric value as a US dollar amount. It takes a numeric `value` as input and returns a string representation of the value formatted with a dollar sign and two decimal places.

##### `group_expenses_by_month` Function

This function takes a list of expenses and groups them by month. It creates a dictionary where the keys are month names in the format "Month Year" (e.g., "January 2023") and the values are lists of expenses that belong to that month. It uses the `datetime` module to parse the date from each expense and extract the month and year information. The function returns the grouped expenses dictionary.

##### `sort_expenses_by_month` Function

This function takes a dictionary of grouped expenses, where the keys are month names and the values are lists of expenses. It sorts the dictionary by the month names in ascending order by converting the month names to datetime objects and using them as the sorting key. The `reverse` parameter allows the sorting order to be reversed if needed. The function returns the sorted expenses dictionary.

These helper functions provide convenient utilities for handling authentication, rendering templates, formatting values, and grouping/sorting expenses in the expense tracker application.
